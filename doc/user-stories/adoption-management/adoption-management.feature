# language: zh-TW
功能: 領養申請管理模組
  作為使用者和管理員
  我希望能夠提交和審核領養申請
  以便完成寵物領養流程

  背景:
    假如 系統中存在以下使用者:
      | 角色         | 使用者名稱 |
      | 收容所管理員 | admin      |
      | 一般使用者   | user       |
    並且 系統中有以下寵物:
      | 編號 | 名稱 | 種類 |
      | P001 | 小白 | 狗   |
      | P002 | 咪咪 | 貓   |

  # ============================================================================
  # 提交領養申請
  # ============================================================================

  場景: 使用者提交領養申請
    假如 我以 "user" 身份登入系統
    當 我進入寵物 "小白" 的詳細頁面
    並且 我點擊 "申請領養" 按鈕
    並且 我填寫以下申請資料:
      | 欄位     | 值                      |
      | 姓名     | 王小明                  |
      | 電話     | 0912345678              |
      | Email    | wang@example.com        |
      | 地址     | 台北市中山區中山路100號 |
      | 領養原因 | 想給家裡小孩一個寵物伴  |
    並且 我點擊 "提交申請" 按鈕
    那麼 我應該看到訊息 "申請已成功提交"
    並且 我應該看到申請編號
    並且 申請狀態應該是 "待審核"
    並且 我應該收到確認通知

  場景: 申請表單缺少必填欄位
    假如 我以 "user" 身份登入系統
    當 我開始填寫領養申請但只填寫:
      | 欄位 | 值         |
      | 姓名 | 王小明     |
      | 電話 | 0912345678 |
    並且 我點擊 "提交申請" 按鈕
    那麼 我應該看到錯誤訊息 "請填寫所有必填欄位"
    並且 以下欄位應該被標記為錯誤:
      | Email    |
      | 地址     |
      | 領養原因 |

  # ============================================================================
  # 查看申請
  # ============================================================================

  場景: 使用者查看自己的申請記錄
    假如 我以 "user" 身份 "王小明" 登入系統
    並且 我有以下申請記錄:
      | 申請編號 | 寵物 | 申請日期   | 狀態   |
      | A001     | 小白 | 2025-10-10 | 待審核 |
      | A002     | 咪咪 | 2025-09-15 | 已核准 |
    當 我進入 "我的申請" 頁面
    那麼 我應該看到 2 筆申請記錄
    並且 申請應該按日期倒序排列

  場景: 查看申請詳細資料
    假如 我以 "user" 身份登入系統
    並且 我有申請編號 "A001"
    當 我進入 "我的申請" 頁面
    並且 我點擊申請 "A001"
    那麼 我應該看到以下資訊:
      | 寵物名稱   |
      | 申請日期   |
      | 當前狀態   |
      | 申請表單內容 |
    並且 如果狀態是 "已核准" 或 "已拒絕"
    那麼 我應該看到審核意見

  場景: 管理員查看所有待審核申請
    假如 我以 "admin" 身份登入系統
    並且 系統中有以下申請:
      | 申請編號 | 申請人 | 寵物 | 申請日期   | 狀態   |
      | A001     | 王小明 | 小白 | 2025-10-14 | 待審核 |
      | A002     | 李小華 | 咪咪 | 2025-10-13 | 待審核 |
      | A003     | 張大同 | 小白 | 2025-10-10 | 已核准 |
    當 我進入申請管理頁面
    那麼 我應該看到 3 筆申請
    當 我選擇篩選 "待審核"
    那麼 我應該看到 2 筆申請
    並且 我應該看到申請 "A001" 和 "A002"

  # ============================================================================
  # 審核申請
  # ============================================================================

  場景: 管理員核准領養申請
    假如 我以 "admin" 身份登入系統
    並且 有一個狀態為 "待審核" 的申請 "A001"
    當 我進入申請 "A001" 的詳細頁面
    並且 我點擊 "審核" 按鈕
    並且 我選擇 "核准"
    並且 我填寫審核意見 "申請人條件符合，核准領養"
    並且 我點擊 "確定" 按鈕
    那麼 我應該看到訊息 "申請已核准"
    並且 申請狀態應該變更為 "已核准"
    並且 申請人應該收到核准通知

  場景: 管理員拒絕領養申請
    假如 我以 "admin" 身份登入系統
    並且 有一個狀態為 "待審核" 的申請 "A001"
    當 我進入申請 "A001" 的詳細頁面
    並且 我點擊 "審核" 按鈕
    並且 我選擇 "拒絕"
    並且 我填寫審核意見 "申請人居住環境不適合飼養寵物"
    並且 我點擊 "確定" 按鈕
    那麼 我應該看到訊息 "申請已拒絕"
    並且 申請狀態應該變更為 "已拒絕"
    並且 申請人應該收到拒絕通知和原因

  場景: 審核時必須填寫意見
    假如 我以 "admin" 身份登入系統
    並且 有一個狀態為 "待審核" 的申請 "A001"
    當 我進入申請 "A001" 的詳細頁面
    並且 我點擊 "審核" 按鈕
    並且 我選擇 "核准"
    並且 我沒有填寫審核意見
    並且 我點擊 "確定" 按鈕
    那麼 我應該看到錯誤訊息 "請填寫審核意見"

  # ============================================================================
  # 取消申請
  # ============================================================================

  場景: 使用者取消待審核的申請
    假如 我以 "user" 身份登入系統
    並且 我有一個狀態為 "待審核" 的申請 "A001"
    當 我進入 "我的申請" 頁面
    並且 我點擊申請 "A001"
    並且 我點擊 "取消申請" 按鈕
    那麼 我應該看到確認對話框 "確定要取消此申請嗎？"
    當 我點擊 "確定"
    那麼 我應該看到訊息 "申請已取消"
    並且 申請狀態應該變更為 "已取消"

  場景: 無法取消已核准的申請
    假如 我以 "user" 身份登入系統
    並且 我有一個狀態為 "已核准" 的申請 "A001"
    當 我進入申請 "A001" 的詳細頁面
    那麼 我不應該看到 "取消申請" 按鈕

  # ============================================================================
  # 整合場景
  # ============================================================================

  場景: 完整的領養申請流程
    假如 我以 "user" 身份 "王小明" 登入系統
    當 我瀏覽寵物並選擇 "小白"
    並且 我提交領養申請並填寫完整資料
    那麼 申請應該成功提交
    並且 狀態應該是 "待審核"

    假如 我以 "admin" 身份登入系統
    當 我查看待審核申請
    並且 我審核 "王小明" 的申請並選擇 "核准"
    那麼 申請狀態應該變更為 "已核准"
    並且 "王小明" 應該收到核准通知
